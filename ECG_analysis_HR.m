#Octave script to calculated HR from#ECG data#Author: Ashish Jagtiani#Octave programming tutorial series for Kengroo.comclear;clc;close all;#data from https://physionet.org/cgi-bin/atm/ATM# From Apnea-ECG database#Record a01ECG_data=csvread('ECG_samples.csv');plot(ECG_data(:,1),ECG_data(:,2));#We are going to use a threshold detector logic to detect the R-wavethreshold = 0.5;threshold_flag=0;size_data = length(ECG_data);data_pointer1 = 1;for (i=1:size_data)#checks when data crosses threshold i.e is greater than thresholdif (ECG_data(i,2)>=threshold && threshold_flag == 0)threshold_cross(data_pointer1,1) = i;threshold_flag=1;#checks when data crosses threshold i.e is lower than thresholdelseif (ECG_data(i,2)<=threshold && threshold_flag == 1)threshold_flag=0;threshold_cross(data_pointer1,2) = i;data_pointer1++;endifendfor#lets find the max data and location of the data when the threshold is crossedlength_peaks =length(threshold_cross);for (i=1:length_peaks)threshold_left= threshold_cross(i,1);threshold_right= threshold_cross(i,2);[x, y]= max(ECG_data(threshold_left:threshold_right,2));peak_data(i)=x;peak_loc(i)=threshold_left + y;endfor#plot data with superimposed peak and threshold_crosshold on;plot(ECG_data(threshold_cross(:,1),1),threshold,'x');plot(ECG_data(threshold_cross(:,2),1),threshold,'x');plot(ECG_data(peak_loc,1),peak_data,'o')xlabel('Time(s)');ylabel('Amplitude');hold off;#Lets calculate the HRsingle_beat=diff(ECG_data(peak_loc,1));HR = 60./single_beat#plot HR as a function of timefigure()HR_time= ECG_data(peak_loc(2:length(peak_loc)),1);plot(HR_time,HR,'o-');xlabel('Time(s)');ylabel('HR (beats/min)')'